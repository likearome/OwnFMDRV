## 개요
이 계열 가장 최신 드라이버인 삼국지 영걸전의 SBOPL2.COM를 디어셈블한 기록 From DOSBOX-X Debugger
SBOPL2.COM이 가장 많은 기능을 구현하고 있으나, 여타 FMDRV.COM도 몇몇 기능은 없지만 구조는 크게 다르지 않음

## FMDRVInterrupt(66h)
0A4F:00000140 80FCFF              cmp  ah,FF                                    
0A4F:00000143 7505                jne  0000014A ($+5)         (down)            
0A4F:00000145 E87D00              call 000001C5 ($+7d)                          
0A4F:00000148 EB6D                jmp  short 000001B7 ($+6d)  (down)            
0A4F:0000014A 80FCFE              cmp  ah,FE                                    
0A4F:0000014D 750E                jne  0000015D ($+e)         (down)            
0A4F:0000014F 2E8A262801          mov  ah,cs:[0128]           cs:[0128]=0001    
0A4F:00000154 B010                mov  al,10                                    
0A4F:00000156 2E8B1E2901          mov  bx,cs:[0129]           cs:[0129]=0000    
0A4F:0000015B EB5A                jmp  short 000001B7 ($+5a)  (down)            
0A4F:0000015D 80FCF0              cmp  ah,F0                                    
0A4F:00000160 751A                jne  0000017C ($+1a)        (down)            
0A4F:00000162 84C0                test al,al                                    
0A4F:00000164 7507                jne  0000016D ($+7)         (down)            
0A4F:00000166 2E8B1E2401          mov  bx,cs:[0124]           cs:[0124]=0000    
0A4F:0000016B EB4A                jmp  short 000001B7 ($+4a)  (down)            
0A4F:0000016D FA                  cli                                           
0A4F:0000016E 2E891E2401          mov  cs:[0124],bx           cs:[0124]=0000    
0A4F:00000173 2EC606220100        mov  byte cs:[0122],00      cs:[0122]=CACA    
0A4F:00000179 FB                  sti                                           
0A4F:0000017A EB3B                jmp  short 000001B7 ($+3b)  (down)            
0A4F:0000017C 80FCF1              cmp  ah,F1                                    
0A4F:0000017F 751A                jne  0000019B ($+1a)        (down)            
0A4F:00000181 84C0                test al,al                                    
0A4F:00000183 7507                jne  0000018C ($+7)         (down)            
0A4F:00000185 2E8B1E2601          mov  bx,cs:[0126]           cs:[0126]=0000    
0A4F:0000018A EB2B                jmp  short 000001B7 ($+2b)  (down)            
0A4F:0000018C FA                  cli                                           
0A4F:0000018D 2E891E2601          mov  cs:[0126],bx           cs:[0126]=0000    
0A4F:00000192 2EC606230100        mov  byte cs:[0123],00      cs:[0123]=00CA    
0A4F:00000198 FB                  sti                                           
0A4F:00000199 EB1C                jmp  short 000001B7 ($+1c)  (down)            
0A4F:0000019B 80FC70              cmp  ah,70                                    
0A4F:0000019E 7207                jc   000001A7 ($+7)         (down)            
0A4F:000001A0 80FC80              cmp  ah,80                                    
0A4F:000001A3 7302                jnc  000001A7 ($+2)         (no jmp)          
0A4F:000001A5 EB11                jmp  short 000001B8 ($+11)  (down)            
0A4F:000001A7 2E803E280100        cmp  byte cs:[0128],00      cs:[0128]=0001    
0A4F:000001AD 7405                je   000001B4 ($+5)         (no jmp)          
0A4F:000001AF E80801              call 000002BA ($+108)       ; 범용 인터럽트 핸들러                  
0A4F:000001B2 EB03                jmp  short 000001B7 ($+3)   (down)            
0A4F:000001B4 B8FFFF              mov  ax,FFFF                                  
0A4F:000001B7 CF                  iret                                          
0A4F:000001B8 2E833E290100        cmp  word cs:[0129],0000    cs:[0129]=0000    
0A4F:000001BE 74F7                je   000001B7 ($-9)         (no jmp)          
0A4F:000001C0 2EFF2E1001          jmp  far word cs:[0110]     cs:[0110]=CA60    

## FMDRV 실제 핸들러
0A4F:0000029A ~ 0A4F:000002B9 : 일반 명령어의 범용 핸들러 벡터 리스트 (2BA 함수에서 분기됨)
명령값 | 주소
0x00: 85 03 => 0A4F:00000385	; FMDRV 배경음악 초기화. 최초 로딩 때 한번만 호출
0x01: B0 03 => 0A4F:000003B0	; 배경음악 연주 시작. 입력 파라미터 - AL: 곡 번호. 버퍼 변경형 게임들은 항상 1만 보냄
0x02: C6 03 => 0A4F:000003C6	; 배경음악 연주 종료. 입력 파라미터 - AL: FadeOut 시간(단위 1값 당 약 0.2초)
0x03: D9 03 => 0A4F:000003D9	; 배경음악 연주 상태 확인. 출력 파라미터 - AH: 연주중인 FM 트랙 번호, AL: 연주 여부(1:연주/0:정지), BX: 현재 재생 시퀀스 카운터
0x04: EC 03 => 0A4F:000003EC	; 배경음악 반복연주 설정. 입력 파라미터 - AL: 반복 여부 (1:반복/0:반복안함)
0x05: F1 03 => 0A4F:000003F1    ; ??? MAIN에서 호출되지 않아 무슨 기능인지 잘 모름
0x06: 33 04 => 0A4F:00000433    ; ??? MAIN에서 호출되지 않아 무슨 기능인지 잘 모름
0x07: 4E 04 => 0A4F:0000044E    ; ??? MAIN에서 호출되지 않아 무슨 기능인지 잘 모름
0x08: 58 04 => 0A4F:00000458    ; ??? MAIN에서 호출되지 않아 무슨 기능인지 잘 모름
0x09: 62 04 => 0A4F:00000462    ; 배경음악 연주 중 호출될 콜백 함수 등록기능

0x10: CD 04 => 0A4F:000004CD	; 효과음 초기화. 최초 로딩때 한번만 호출
0x11: FE 04 => 0A4F:000004FE	; 효과음 연주 시작
0x12: 12 05 => 0A4F:00000512	; 효과음 연주 종료
0x13: 2D 05 => 0A4F:0000052D	; 효과음 연주 상태 확인

0x80: 3A 05 => 0A4F:0000053A	; 아마도 PCM 연주와 관계된 듯? FMDRV에는 없음
0x81: 4D 05 => 0A4F:0000054D	; 아마도 PCM 연주와 관계된 듯? FMDRV에는 없음

0xF0: 핸들러 자체 설정 - 타이머 1. 입력 파라미터 - AL: 읽기/쓰기 여부 (1:쓰기/0:읽기) BX: 쓰기일 때 최초 카운터 값 / 출력 파라미터 - BX: 현재 감소된 카운터 값
0xF1: 핸들러 자체 설정 - 타이머 2. 입력 파라미터 - AL: 읽기/쓰기 여부 (1:쓰기/0:읽기) BX: 쓰기일 때 최초 카운터 값 / 출력 파라미터 - BX: 현재 감소된 카운터 값
0xFE: 아마 동작성 설정 확인인 듯? OPL인지 PCM인지? FMDRV에는 없음
0xFF: FMDRV 종료 및 TSR 해제

## TickInterrupt(08h)
0A4F:00000225 50                  push ax                                       
0A4F:00000226 1E                  push ds                                       
0A4F:00000227 8CC8                mov  ax,cs                                    
0A4F:00000229 8ED8                mov  ds,ax                                    
0A4F:0000022B A11801              mov  ax,[0118]              ds:[0118]=0000    
0A4F:0000022E 01061A01            add  [011A],ax              ds:[011A]=0000    
0A4F:00000232 7304                jnc  00000238 ($+4)         (down)            
0A4F:00000234 FF061C01            inc  word [011C]            ;임의의 카운터 [0118]의 값을 더해서 word 캐리가 발생시 [011C] 증가
0A4F:00000238 8006200136          add  byte [0120],36         ds:[0120]=0000    
0A4F:0000023D 7304                jnc  00000243 ($+4)         (down)            
0A4F:0000023F FF061E01            inc  word [011E]            ;FMDRV 커스터마이즈 틱 hz가 291.304hz. 
                                                              ;291.304 / (256/54 = 4.740) = 61hz마다 [011E]의 값이 1씩 올라가는 카운터
0A4F:00000243 8006220135          add  byte [0122],35         ds:[0122]=0000    
0A4F:00000248 730B                jnc  00000255 ($+b)         (down)            
0A4F:0000024A 833E240100          cmp  word [0124],0000       
0A4F:0000024F 7404                je   00000255 ($+4)         (down)            
0A4F:00000251 FF0E2401            dec  word [0124]            ;FMDRV 커스터마이즈 틱 hz가 291.304hz.
                                                              ;291.304 / (256/53 = 4.830) = 60hz마다 [0124]의 값이 1씩 내려가는 카운터 (타이머 용)   
0A4F:00000255 8006230135          add  byte [0123],35         ds:[0123]=0000    
0A4F:0000025A 730B                jnc  00000267 ($+b)         (down)            
0A4F:0000025C 833E260100          cmp  word [0126],0000       ds:[0126]=0000    
0A4F:00000261 7404                je   00000267 ($+4)         (down)            
0A4F:00000263 FF0E2601            dec  word [0126]            ;FMDRV 커스터마이즈 틱 hz가 291.304hz. 
                                                              ;291.304 / (256/53 = 4.830) = 60hz마다 [0126]의 값이 1씩 내려가는 카운터 (타이머 용)     
0A4F:00000267 FE0E2101            dec  byte [0121]            ;291.304 / 16 = 초당 18.2065hz (타이머 기본 주파수)마다 cs:[0114]에 있는 주소값(=기존 타이머)로 점프
0A4F:0000026B 750C                jne  00000279 ($+c)         (no jmp)          
0A4F:0000026D C606210110          mov  byte [0121],10         ds:[0121]=0000    
0A4F:00000272 1F                  pop  ds                                       
0A4F:00000273 58                  pop  ax                                       
0A4F:00000274 2EFF2E1401          jmp  far word cs:[0114]     ; 기존 틱 파라미터의 위치 값.   
0A4F:00000279 B020                mov  al,20                                    
0A4F:0000027B E620                out  20,al                                    
0A4F:0000027D 803E2E0700          cmp  byte [072E],00         ; [072E]=OPL Semaphore값. Semaphore가 허용상태인지 확인
0A4F:00000282 7513                jne  00000297 ($+13)        (no jmp)          
0A4F:00000284 A11C01              mov  ax,[011C]              ds:[011C]=0000    
0A4F:00000287 0B061E01            or   ax,[011E]              ds:[011E]=0000    
0A4F:0000028B 740A                je   00000297 ($+a)         (down)            
0A4F:0000028D 803E280100          cmp  byte [0128],00         ds:[0128]=0000    
0A4F:00000292 7403                je   00000297 ($+3)         (down)            
0A4F:00000294 E84307              call 000009DA ($+743)       ; [0128]에 있는 값이 0이 아니면 이 함수가 호출됨. 거의 항상 [0128]에는 1이 들어있으므로 호출됨.               
0A4F:00000297 1F                  pop  ds                                       
0A4F:00000298 58                  pop  ax                                       
0A4F:00000299 CF                  iret 
